â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        ORPHAN FUNCTIONS - QUICK REFERENCE GUIDE                          â•‘
â•‘               WelcomeCRM - AnÃ¡lise de SeguranÃ§a                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNÃ‡ÃƒO 1: is_manager_or_admin()
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: âš ï¸ ATIVA - NÃƒO REMOVER
Arquivo: /supabase/migrations/20260121130000_roles_teams_separation.sql
Linhas: 116-134
Trigger: NÃ£o
RLS Policy: NÃ£o
CÃ³digo: NÃ£o chamada diretamente
Risco: ALTO se remover (quebra RBAC)

RecomendaÃ§Ã£o: MANTER - FunÃ§Ã£o helper legÃ­tima para RBAC


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNÃ‡ÃƒO 2: has_role(role_name TEXT)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: âš ï¸ ATIVA - NÃƒO REMOVER
Arquivo: /supabase/migrations/20260121130000_roles_teams_separation.sql
Linhas: 99-113
Trigger: NÃ£o
RLS Policy: NÃ£o
CÃ³digo: NÃ£o chamada diretamente
Risco: ALTO se remover (quebra verificaÃ§Ãµes de role)

RecomendaÃ§Ã£o: MANTER - Helper genÃ©rico reutilizÃ¡vel


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNÃ‡ÃƒO 3: is_privileged_user()
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: ğŸ”´ PHANTOM - REMOVER
Banco: NÃƒO EXISTE
Arquivo de Tipo: /src/database.types.ts (linha 6279)
Trigger: NÃ£o
RLS Policy: NÃ£o
CÃ³digo: NÃ£o chamada
Risco: ZERO se remover (nÃ£o existe no BD)

RecomendaÃ§Ã£o: REMOVER de database.types.ts apÃ³s regeneraÃ§Ã£o


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNÃ‡ÃƒO 4: is_card_owner(p_card_id uuid)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: ğŸ”´ PHANTOM - REMOVER
Banco: NÃƒO EXISTE
Arquivo de Tipo: /src/database.types.ts (linha 6275)
Trigger: NÃ£o
RLS Policy: NÃ£o
CÃ³digo: NÃ£o chamada
Risco: ZERO se remover (nÃ£o existe no BD)

RecomendaÃ§Ã£o: REMOVER de database.types.ts apÃ³s regeneraÃ§Ã£o


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNÃ‡ÃƒO 5: find_contact_by_whatsapp(p_convo_id, p_phone)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: ğŸ”´ PHANTOM - REMOVER
Banco: NÃƒO EXISTE
Arquivo de Tipo: /src/database.types.ts (linhas 6199-6202)
Trigger: NÃ£o
RLS Policy: NÃ£o
CÃ³digo: NÃ£o chamada
Risco: ZERO se remover (nÃ£o existe no BD)

RecomendaÃ§Ã£o: REMOVER de database.types.ts apÃ³s regeneraÃ§Ã£o


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNÃ‡ÃƒO 6: validate_transition(p_card_id, p_target_stage_id)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: âš ï¸ ATIVA - NÃƒO REMOVER
Arquivo: /supabase/migrations/20251214230000_admin_governance.sql
Linhas: 35-67
Trigger: NÃ£o
RLS Policy: NÃ£o
CÃ³digo: NÃ£o chamada diretamente (mas em database.types.ts)
Risco: CRÃTICO se remover (quebra validaÃ§Ã£o de pipeline)

RecomendaÃ§Ã£o: MANTER - FunÃ§Ã£o crÃ­tica de validaÃ§Ã£o


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNÃ‡ÃƒO 7: pode_avancar_etapa(p_card_id, p_nova_etapa_id)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: ğŸ”´ PHANTOM - REMOVER
Banco: NÃƒO EXISTE
Arquivo de Tipo: /src/database.types.ts (linhas 6318-6321)
Trigger: NÃ£o
RLS Policy: NÃ£o
CÃ³digo: NÃ£o chamada
Risco: ZERO se remover (nÃ£o existe no BD)
Nota: Funcionalidade estÃ¡ em validate_transition

RecomendaÃ§Ã£o: REMOVER de database.types.ts apÃ³s regeneraÃ§Ã£o


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNÃ‡ÃƒO 8: log_tarefa_activity() [VERSÃƒO 1]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: ğŸŸ¢ LEGADO - REMOVER
Arquivo 1: /supabase/migrations/20251210123247_complete_activity_logging.sql
Arquivo 2: /supabase/migrations/20251224000003_update_activity_log.sql
Arquivo 3: /supabase/migrations/20251224000005_improve_reschedule_log.sql
Trigger Original: âŒ DROPADO em 20251224120000
VersÃ£o Ativa: log_tarefa_activity_v2 (20251224163000_fix_meeting_logic.sql)
Risco: ZERO se remover (v2 jÃ¡ estÃ¡ ativa)

RecomendaÃ§Ã£o: REMOVER definiÃ§Ãµes v1, manter v2


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PLANO DE AÃ‡ÃƒO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASSO 1: Regenerar database.types.ts
  $ supabase gen types typescript > src/database.types.ts

  Isso removerÃ¡ automaticamente as 4 phantom functions

PASSO 2: Limpar definiÃ§Ãµes legado de log_tarefa_activity v1
  Editar arquivo:
    - supabase/migrations/20251210123247_complete_activity_logging.sql
    - supabase/migrations/20251224000003_update_activity_log.sql
    - supabase/migrations/20251224000005_improve_reschedule_log.sql

  Remover blocos de CREATE OR REPLACE FUNCTION log_tarefa_activity()

PASSO 3: VerificaÃ§Ã£o
  $ grep -rn "is_privileged_user\|is_card_owner\|find_contact_by_whatsapp\|pode_avancar_etapa\|log_tarefa_activity[^_]" src/ database.types.ts

PASSO 4: Testar
  $ npm run dev


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMO EXECUTIVO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MANTER (3):
  - is_manager_or_admin() â† RBAC Helper
  - has_role() â† Role Checker
  - validate_transition() â† Pipeline Validation

REMOVER PHANTOM (4):
  - is_privileged_user
  - is_card_owner
  - find_contact_by_whatsapp
  - pode_avancar_etapa

REMOVER LEGADO (1):
  - log_tarefa_activity() [v1]

SEGURANÃ‡A: âœ… 100% - Risco ZERO de quebrar cÃ³digo ativo


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TABELA RÃPIDA DE DECISÃƒO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FunÃ§Ã£o                    | Status    | DecisÃ£o
--------------------------|-----------|------------------
is_manager_or_admin       | Ativo     | âš ï¸  MANTER
has_role                  | Ativo     | âš ï¸  MANTER
is_privileged_user        | Phantom   | ğŸŸ¢ REMOVER
is_card_owner             | Phantom   | ğŸŸ¢ REMOVER
find_contact_by_whatsapp  | Phantom   | ğŸŸ¢ REMOVER
validate_transition       | Ativo     | âš ï¸  MANTER
pode_avancar_etapa        | Phantom   | ğŸŸ¢ REMOVER
log_tarefa_activity v1    | Legado    | ğŸŸ¢ REMOVER


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Para documentaÃ§Ã£o completa, veja:
  /sessions/sleepy-epic-clarke/mnt/WelcomeCRM/ORPHAN_FUNCTIONS_AUDIT_REPORT.md
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
